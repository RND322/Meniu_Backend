<!-- cajero.html -->
<!DOCTYPE html><html><body>
  <h1>ğŸ’° Panel Caja</h1>
  <ul id="lista"></ul>

  <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
  <script>
    const RESTAURANTE_ID = 1;
    const socket = io('http://localhost:3000', {
      query: { role: 'cajero', restauranteId: RESTAURANTE_ID },
      transports: ['websocket', 'polling'],
      reconnection: true,
      reconnectionAttempts: 5,
      reconnectionDelay: 1000
    });

    const lista = document.getElementById('lista');

    socket.on('connect', () => {
      console.log('ğŸ”— Conectado al servidor');
    });

    socket.on('disconnect', () => {
      console.log('ğŸ”Œ Desconectado del servidor');
    });

    socket.on('joined', room => console.log(`âœ… Unido a sala ${room}`));
    
    socket.on('nueva_orden', orden => {
      console.log('ğŸ’¸ Nueva orden en caja:', orden);

      // Crea un elemento <li> con los detalles bÃ¡sicos
      const li = document.createElement('li');
      li.textContent = `Orden ${orden.id_orden} â€” Mesa ${orden.mesa.numero_mesa} â€” Total: $${orden.total}`;
      lista.appendChild(li);

      // (Opcional) BotÃ³n para "marcar como cobrado"
      const btn = document.createElement('button');
      btn.textContent = 'Cobrar';
      btn.onclick = () => {
        // aquÃ­ podrÃ­as llamar a un endpoint de "confirmar cobro"
        btn.disabled = true;
        li.style.opacity = '0.5';
      };
      li.appendChild(btn);
    });

    // Manejar cierre de pÃ¡gina
    window.addEventListener('beforeunload', () => {
      console.log('ğŸ”„ Cerrando conexiÃ³n...');
      socket.disconnect();
    });
  </script>
</body></html>
